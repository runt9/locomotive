vm_hostname = 'locomotive-local'
vm_cpu = 2
vm_ram = 2048

Vagrant.configure(2) do |config|
  config.vm.box_url = 'https://atlas.hashicorp.com/ARTACK/boxes/debian-jessie'
  config.vm.box = 'ARTACK/debian-jessie'

  config.vm.define "#{vm_hostname}" do |node|
    node.vm.provider :virtualbox do |vb|
      # Web server
      node.vm.network 'forwarded_port', guest: 8080, host: 8085
      # Postgres
      node.vm.network 'forwarded_port', guest: 5432, host: 15432
      node.vm.synced_folder 'target', '/usr/local/locomotive/target', create: true

      vb.memory = vm_ram
      vb.cpus = vm_cpu
      vb.customize ['modifyvm', :id, '--usb', 'off']
      vb.customize ['modifyvm', :id, '--usbehci', 'off']
    end
  end

  # Initial Ansible provisioning
  config.vm.provision :ansible do |ansible|
    ansible.playbook = 'provision/playbook.yml'
    ansible.groups = {
        'all' => ["#{vm_hostname}"]
    }
    ansible.sudo = true
    ansible.raw_arguments = ENV['ANSIBLE_ARGS']
  end
end